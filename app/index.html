<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Mi Recetario Personal</title>
    <link rel="icon" href="imagenes/logo.png">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="jqm/jquery.mobile-1.4.5.css">
    <script src="jqm/jquery-1.12.3.min.js"></script>
    <script src="jqm/jquery.mobile-1.4.5.js"></script>
    <link rel="stylesheet" href="estilos.css">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Josefin+Sans:wght@450&display=swap"
        rel="stylesheet">
    <style>
        .nota {
            background-color: rgb(143, 11, 11);
            color: white;
            border: 4px solid rgb(168, 58, 58);
            padding: 18px;
            position: relative;
            margin: 10px 0;
            text-shadow: none;
            box-shadow: 2px 2px rgb(0, 0, 0, .3);
            border-radius: 30px;
        }

        .nota2 {
            background-color: rgb(139, 196, 146);
            color: white;
            border: 4px solid rgb(84, 197, 137);
            padding: 18px;
            position: relative;
            margin: 10px 0;
            text-shadow: none;
            box-shadow: 2px 2px rgb(0, 0, 0, .3);
            border-radius: 30px;
        }

        .nota3 {
            background-color: rgb(48, 79, 190);
            color: white;
            border: 4px solid rgb(49, 79, 190);
            padding: 18px;
            position: relative;
            margin: 10px 0;
            text-shadow: none;
            box-shadow: 2px 2px rgb(0, 0, 0, .3);
            border-radius: 30px;
        }

        .nota4 {
            background-color: rgb(230, 88, 204);
            color: white;
            border: 4px solid rgb(231, 88, 204);
            padding: 18px;
            position: relative;
            margin: 10px 0;
            text-shadow: none;
            box-shadow: 2px 2px rgb(0, 0, 0, .3);
            border-radius: 30px;
        }

        .check {
            position: absolute;
            background-color: rgb(43, 226, 83);
            padding: 7px;
            border-radius: 50%;
            line-height: 0;
            top: 20px;
            right: 118px;
        }

        .edit {
            position: absolute;
            padding: 7px;
            border-radius: 50%;
            line-height: 0;
            background: rgb(255, 255, 0);
            top: 20px;
            right: 60px;
        }

        .delete {
            position: absolute;
            padding: 7px;
            border-radius: 50%;
            line-height: 0;
            background: rgb(255, 0, 0);
            top: 20px;
            right: 8px;
        }

        .form-buttons {
            display: flex;
            flex-direction: column;
        }

        .form-buttons a,
        .form-buttons input {
            margin-bottom: 10px;
        }
    </style>
    <script>
        $(document).ready(function () {
            // Función para manejar el registro de usuario
            function registerUser(username, password) {
                $.post('https://palegreen-mandrill-927363.hostingersite.com/database/register.php', {
                    username: username,
                    password: password
                }).done(function (response) {
                    console.log(response); // Ver la respuesta real
                    if (response.success) {
                        alert('Registro exitoso. Por favor, inicia sesión.');
                        $.mobile.changePage("#login");
                    } else {
                        alert('Error de registro: ' + (response.error || 'Desconocido'));
                        localStorage.setItem(username, password);
                        alert('Registro guardado en local storage.');
                    }
                }).fail(function () {
                    localStorage.setItem(username, password);
                    alert('Error de conexión. Registrando en local storage.');
                });
            }

            // Función para manejar el login de usuario
            function loginUser(username, password) {
                $.post('https://palegreen-mandrill-927363.hostingersite.com/database/login.php', {
                    username: username,
                    password: password
                }).done(function (response) {
                    if (response.success) {
                        alert('Login exitoso.');
                        localStorage.setItem('activeSession', username);
                        $.mobile.changePage("#home");
                        loadNotesFromDatabase();
                    } else {
                        alert('Datos incorrectos.');
                    }
                }).fail(function () {
                    if (localStorage.getItem(username) === password) {
                        alert('Login exitoso (local storage).');
                        localStorage.setItem('activeSession', username);
                        $.mobile.changePage("#home");
                        loadLocalNotes();
                    } else {
                        alert('Error de conexión y datos incorrectos.');
                    }
                });
            }

            // Función para cargar notas desde la base de datos
            function loadNotesFromDatabase() {
                var usuario_id = localStorage.getItem('activeSession');
                $.get('https://palegreen-mandrill-927363.hostingersite.com/database/get_notes.php', {
                    usuario_id: usuario_id,
                    tipo: 'desayuno'
                }).done(function (response) {
                    displayNotes(response, '#notas', 'nota');
                }).fail(function () {
                    loadLocalNotes();
                });
            }

            // Función para mostrar notas en el DOM
            function displayNotes(notes, container, className) {
                $(container).empty();
                notes.forEach(function (note) {
                    var noteElement = $('<div></div>')
                        .attr('class', className)
                        .attr('data-cumplido', note.cumplido ? 'si' : 'no')
                        .append('<a href="#" class="check"><img src="imagenes/a.png" alt="a"></a>')
                        .append('<a href="#" class="edit"><img src="imagenes/b.png" alt="b"></a>')
                        .append('<a href="#" class="delete"><img src="imagenes/c.png" alt="c"></a>')
                        .append('<h3>' + note.titulo + '</h3>')
                        .append('<p>' + note.contenido + '</p>');

                    if (note.cumplido) {
                        noteElement.css({ backgroundColor: "green", color: "white" });
                    }

                    $(container).append(noteElement);
                });
            }

            // Eventos de registro y login
            $('#register-form').on('submit', function (e) {
                e.preventDefault();
                var username = $('#register-username').val();
                var password = $('#register-password').val();
                registerUser(username, password);
            });

            $('#login-form').on('submit', function (e) {
                e.preventDefault();
                var username = $('#login-username').val();
                var password = $('#login-password').val();
                loginUser(username, password);
            });

            // Evento para añadir nueva receta de Desayuno
            $('#agregar form').on('submit', function (e) {
                e.preventDefault();
                var titulo = $('#titulo').val();
                var contenido = $('#contenido').val();
                var usuario = localStorage.getItem('activeSession');
                var nuevaNota = {
                    usuario: usuario,
                    tipo: 'desayuno',
                    titulo: titulo,
                    contenido: contenido,
                    cumplido: false
                };
                guardarNota(nuevaNota);
                $.mobile.navigate('#desayuno');
            });

            // Función para guardar notas
            function guardarNota(nuevaNota) {
                $.post('https://palegreen-mandrill-927363.hostingersite.com/database/save_note.php', nuevaNota)
                    .done(function (response) {
                        if (!response.success) {
                            alert('Error guardando nota en la base de datos: ' + (response.error || 'Desconocido'));
                        } else {
                            alert('Nota guardada exitosamente.');
                            loadNotesFromDatabase();
                        }
                    }).fail(function () {
                        alert('Error de conexión. Intentelo de nuevo más tarde.');
                    });
            }

            // Cerrar sesión
            $('#logout-button, #logout-button-footer').on('click', function () {
                localStorage.removeItem('activeSession');
                alert('Sesión cerrada.');
                $.mobile.changePage("#login");
            });

            // Mostrar sesión activa en consola
            if (localStorage.getItem('activeSession')) {
                console.log('Sesión activa: ' + localStorage.getItem('activeSession'));
                loadNotesFromDatabase();
            }
        });
    </script>
</head>

<body>
    <!-- Login -->
    <div data-role="page" id="login" data-theme="b">
        <div data-role="header">
            <h1>Login</h1>
        </div>
        <div role="main" class="ui-content">
            <form id="login-form">
                <input type="text" id="login-username" name="username" autocomplete="username" required
                    placeholder="Nombre de usuario">
                <input type="password" id="login-password" name="password" autocomplete="current-password" required
                    placeholder="Contraseña">
                <div class="form-buttons">
                    <input type="submit" value="Login" data-inline="true" data-theme="a">
                    <a href="#register" data-role="button" data-inline="true">Registrarse</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Registro -->
    <div data-role="page" id="register" data-theme="b">
        <div data-role="header">
            <h1>Registrarse</h1>
        </div>
        <div role="main" class="ui-content">
            <form id="register-form">
                <input type="text" id="register-username" name="username" autocomplete="username" required
                    placeholder="Nombre de usuario">
                <input type="password" id="register-password" name="password" autocomplete="new-password" required
                    placeholder="Contraseña">
                <div class="form-buttons">
                    <input type="submit" value="Registrarse" data-inline="true" data-theme="a">
                    <a href="#login" data-role="button" data-inline="true">Login</a>
                </div>
            </form>
        </div>
    </div>

    <div data-role="page" id="home">
        <div data-role="header" data-position="fixed">
            <img src="imagenes/logo (2).png" alt="logo" width="90%" height="100%" class="logo">
            <a href="#" id="logout-button" data-role="button" data-inline="true" data-theme="a"
                class="ui-btn-left">Cerrar sesión</a>
        </div>
        <!-- menu -->
        <div role="main" class="ui-content" id="mana">
            <div class="ui-grid-a">
                <div class="ui-block-a">
                    <a href="#desayuno">
                        <img src="imagenes/desayuno.jpg" alt="icono grid">
                    </a>
                </div>
                <div class="ui-block-b">
                    <a href="#almuerzo">
                        <img src="imagenes/almuerzo.jpg" alt="icono grid">
                    </a>
                </div>
                <div class="ui-block-a">
                    <a href="#merienda">
                        <img src="imagenes/merienda.jpg" alt="icono grid">
                    </a>
                </div>
                <div class="ui-block-b">
                    <a href="#cena">
                        <img src="imagenes/cena.jpg" alt="icono grid">
                    </a>
                </div>
            </div>
            <div data-role="footer" data-position="fixed" id="footer">
                <a href="#pop" data-role="button" data-icon="info" data-iconpos="notext" data-inline="true"
                    data-rel="popup">
                    <p>Info</p>
                </a>
                <div id="pop" data-role="popup" data-overlay-theme="b" data-history="false" data-corners="false"
                    class="ui-content" data-transition="slidedown">
                    <a href="#" data-rel="back" data-role="button" data-icon="delete" data-iconpos="notext"
                        class="ui-btn-right" data-theme="b" data-direction="reverse"
                        data-transition="slidedown">Cerrar</a>
                    <ul data-role="listview">
                        <li data-role="list-divider" data-theme="b">Desarrollo de Aplicaciones Multiplataforma</li>
                        <li>
                            <a href="#">
                                <img src="imagenes/aix.png" alt="aixa"
                                    style="border-radius: 50%; width: 60px; margin: 10px; box-shadow: rgba(0, 0, 0, .5) 2px 2px 0px;">
                                <h3>AIXA CALCAGNO <br><br></h3>
                                <p>CURSO: DMT5BV</p>
                                <span class="ui-li-count">TARDE</span>
                            </a>
                            <a href="mailto:aixa.calcagno@davinci.edu.ar">mail</a>
                        </li>
                        <li data-role="list-divider" data-theme="b"></li>
                        <li>
                            <a href="#">
                                <img src="imagenes/noe.png" alt="corona virus"
                                    style="border-radius: 50%; width: 60px; margin: 10px; box-shadow: rgba(0, 0, 0, .4) 2px 2px 0px;">
                                <h3>NOELIA NOVO <br><br></h3>
                                <p>Divergente</p>
                                <span class="ui-li-count">TARDE</span>
                            </a>
                            <a href="mailto:noelia.novo@davinci.edu.ar">mail</a>
                        </li>
                    </ul>
                </div>
                <a href="#" id="logout-button-footer" data-role="button" data-inline="true" data-theme="a"
                    class="ui-btn-center">Cerrar sesión</a>
            </div>
        </div>
    </div>
    <!-- fin de menu -->

    <!-- Desayuno -->
    <div data-role="page" id="desayuno" data-theme="b">
        <div data-role="header">
            <h1>Desayunos</h1>
            <a href="#home" data-role="button" data-inline="true" class="back-right">Volver</a>
            <a href="#agregar">Agregar</a>
        </div>
        <div role="main" class="ui-content">
            <div id="notas"></div>
        </div>
    </div>

    <!-- agregar nota nueva -->
    <div data-role="page" id="agregar" data-theme="b">
        <div data-role="header">
            <h1>Nuevo Desayuno</h1>
            <a href="#" data-rel="back">Volver</a>
        </div>
        <div role="main" class="ui-content">
            <form>
                <input type="text" id="titulo" required placeholder="El título de la receta va acá...">
                <input type="text" id="contenido" required placeholder="Tu receta va acá...">
                <a href="#" class="botonesedit" data-role="button" data-inline="true" data-rel="back">Cancelar</a>
                <input type="submit" value="Guardar" data-inline="true" data-theme="a">
            </form>
        </div>
    </div>

    <!-- modificar receta -->
    <div data-role="page" id="modificar" data-theme="b">
        <div data-role="header">
            <h1>Modificar Receta</h1>
        </div>
        <div role="main" class="ui-content">
            <form>
                <input type="text" id="modifica_titulo" required placeholder="El título de la receta va acá...">
                <input type="text" id="modifica_contenido" required placeholder="Tu receta va acá...">
                <a href="#" data-role="button" class="botonesedit" data-inline="true" data-rel="back">Cancelar</a>
                <input type="submit" value="Guardar" data-inline="true" data-theme="a">
            </form>
        </div>
    </div>

    <!-- Almuerzo -->
    <div data-role="page" id="almuerzo">
        <div data-role="header">
            <h1>Almuerzos</h1>
            <a href="#home" data-role="button" data-inline="true" class="back-right">Volver</a>
            <a href="#agregar2">Agregar</a>
        </div>
        <div role="main" class="ui-content">
            <div id="notas2"></div>
        </div>
    </div>

    <!-- agregar nota nueva -->
    <div data-role="page" id="agregar2">
        <div data-role="header">
            <h1>Nuevo Almuerzo</h1>
            <a href="#" data-rel="back">Volver</a>
        </div>
        <div role="main" class="ui-content">
            <form>
                <input type="text" id="titulo2" required placeholder="El titulo de la receta va acá...">
                <input type="text" id="contenido2" required placeholder="Tu receta va acá...">
                <a href="#" class="botonesedit" data-role="button" data-inline="true" data-rel="back">Cancelar</a>
                <input type="submit" value="Guardar" data-inline="true" data-theme="a">
            </form>
        </div>
    </div>

    <!-- modificar receta -->
    <div data-role="page" id="modificar2">
        <div data-role="header">
            <h1>Modificar Receta</h1>
        </div>
        <div role="main" class="ui-content">
            <form>
                <input type="text" id="modifica_titulo2" required placeholder="El título de la receta va acá...">
                <input type="text" id="modifica_contenido2" required placeholder="Tu receta va acá...">
                <a href="#" data-role="button" class="botonesedit" data-inline="true" data-rel="back">Cancelar</a>
                <input type="submit" value="Guardar" data-inline="true" data-theme="b">
            </form>
        </div>
    </div>

    <!-- Merienda -->
    <div data-role="page" id="merienda" data-theme="c">
        <div data-role="header">
            <h1>Merienda</h1>
            <a href="#home" data-role="button" data-inline="true" class="back-right">Volver</a>
            <a href="#agregar3">Agregar</a>
        </div>
        <div role="main" class="ui-content">
            <div id="notas3"></div>
        </div>
    </div>

    <!-- agregar nota nueva -->
    <div data-role="page" id="agregar3" data-theme="c">
        <div data-role="header">
            <h1>Nueva Merienda</h1>
            <a href="#" data-rel="back">Volver</a>
        </div>
        <div role="main" class="ui-content">
            <form>
                <input type="text" id="titulo3" required placeholder="El título de la receta va acá...">
                <input type="text" id="contenido3" required placeholder="Tu receta va acá...">
                <a href="#" class="botonesedit" data-role="button" data-inline="true" data-rel="back">Cancelar</a>
                <input type="submit" value="Guardar" data-inline="true" data-theme="a">
            </form>
        </div>
    </div>

    <!-- modificar receta -->
    <div data-role="page" id="modificar3" data-theme="c">
        <div data-role="header">
            <h1>Modificar Receta</h1>
        </div>
        <div role="main" class="ui-content">
            <form>
                <input type="text" id="modifica_titulo3" required placeholder="El título de la receta va acá...">
                <input type="text" id="modifica_contenido3" required placeholder="El contenido de la receta va acá...">
                <a href="#" data-role="button" class="botonesedit" data-inline="true" data-rel="back">Cancelar</a>
                <input type="submit" value="Guardar" data-inline="true" data-theme="b">
            </form>
        </div>
    </div>

    <!-- Cena -->
    <div data-role="page" id="cena" data-theme="d">
        <div data-role="header">
            <h1>Cena</h1>
            <a href="#home" data-role="button" data-inline="true" class="back-right">Volver</a>
            <a href="#agregar4">Agregar</a>
        </div>
        <div role="main" class="ui-content">
            <div id="notas4"></div>
        </div>
    </div>

    <!-- agregar nota nueva -->
    <div data-role="page" id="agregar4" data-theme="d">
        <div data-role="header">
            <h1>Nueva Cena</h1>
            <a href="#" data-rel="back">Volver</a>
        </div>
        <div role="main" class="ui-content">
            <form>
                <input type="text" id="titulo4" required placeholder="El título de la receta va acá...">
                <input type="text" id="contenido4" required placeholder="Tu receta va acá...">
                <a href="#" class="botonesedit" data-role="button" data-inline="true" data-rel="back">Cancelar</a>
                <input type="submit" value="Guardar" data-inline="true" data-theme="a">
            </form>
        </div>
    </div>

    <!-- modificar receta -->
    <div data-role="page" id="modificar4" data-theme="d">
        <div data-role="header">
            <h1>Modificar Receta</h1>
        </div>
        <div role="main" class="ui-content">
            <form>
                <input type="text" id="modifica_titulo4" required placeholder="El título de la receta va acá...">
                <input type="text" id="modifica_contenido4" required placeholder="El contenido de la receta va acá...">
                <a href="#" data-role="button" class="botonesedit" data-inline="true" data-rel="back">Cancelar</a>
                <input type="submit" value="Guardar" data-inline="true" data-theme="b">
            </form>
        </div>
    </div>


</body>

</html>